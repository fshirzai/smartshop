{"ast":null,"code":"var _jsxFileName = \"/data/data/com.termux/files/home/fsprojects/myapp/src/contexts/CartContext.jsx\",\n  _s = $RefreshSig$();\nimport { createContext, useState, useEffect, useCallback, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport { useAuth } from '../hooks/useAuth';\nimport { orderAPI } from '../api/orderAPI';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const CartContext = /*#__PURE__*/createContext();\nconst CART_KEY = 'cart';\nexport const CartProvider = ({\n  children\n}) => {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const [items, setItems] = useState([]);\n  useEffect(() => {\n    const raw = localStorage.getItem(CART_KEY);\n    if (raw) setItems(JSON.parse(raw));\n  }, []);\n  useEffect(() => {\n    localStorage.setItem(CART_KEY, JSON.stringify(items));\n  }, [items]);\n  useEffect(() => {\n    if (!user) return;\n    (async () => {\n      try {\n        const {\n          data\n        } = await orderAPI.getMyOrders();\n        const latest = data[0];\n        if (latest && latest.items.length) setItems(latest.items);\n      } catch {}\n    })();\n  }, [user]);\n  const addToCart = useCallback((product, qty = 1) => {\n    setItems(prev => {\n      const exist = prev.find(x => x._id === product._id);\n      if (exist) {\n        const updated = {\n          ...exist,\n          qty: Math.min(exist.qty + qty, product.stock)\n        };\n        return prev.map(x => x._id === product._id ? updated : x);\n      }\n      return [...prev, {\n        ...product,\n        qty\n      }];\n    });\n  }, []);\n  const updateQty = useCallback((id, qty) => {\n    setItems(prev => prev.map(x => x._id === id ? {\n      ...x,\n      qty: Math.min(Math.max(qty, 1), x.stock)\n    } : x));\n  }, []);\n  const removeFromCart = useCallback(id => {\n    setItems(prev => prev.filter(x => x._id !== id));\n  }, []);\n  const clearCart = useCallback(() => setItems([]), []);\n  const totalPrice = useMemo(() => items.reduce((sum, i) => sum + i.price * i.qty, 0), [items]);\n  const value = {\n    cartItems: items,\n    addToCart,\n    updateQty,\n    removeFromCart,\n    clearCart,\n    totalPrice\n  };\n  return /*#__PURE__*/_jsxDEV(CartContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 10\n  }, this);\n};\n_s(CartProvider, \"0MxLhbfEMXsxIqfU+TR59NW2eT8=\", false, function () {\n  return [useAuth];\n});\n_c = CartProvider;\nCartProvider.propTypes = {\n  children: PropTypes.node.isRequired\n};\nvar _c;\n$RefreshReg$(_c, \"CartProvider\");","map":{"version":3,"names":["createContext","useState","useEffect","useCallback","useMemo","PropTypes","useAuth","orderAPI","jsxDEV","_jsxDEV","CartContext","CART_KEY","CartProvider","children","_s","user","items","setItems","raw","localStorage","getItem","JSON","parse","setItem","stringify","data","getMyOrders","latest","length","addToCart","product","qty","prev","exist","find","x","_id","updated","Math","min","stock","map","updateQty","id","max","removeFromCart","filter","clearCart","totalPrice","reduce","sum","i","price","value","cartItems","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","propTypes","node","isRequired","$RefreshReg$"],"sources":["/data/data/com.termux/files/home/fsprojects/myapp/src/contexts/CartContext.jsx"],"sourcesContent":["import { createContext, useState, useEffect, useCallback, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport { useAuth } from '../hooks/useAuth';\nimport { orderAPI } from '../api/orderAPI';\n\nexport const CartContext = createContext();\n\nconst CART_KEY = 'cart';\n\nexport const CartProvider = ({ children }) => {\n  const { user } = useAuth();\n  const [items, setItems] = useState([]);\n\n  useEffect(() => {\n    const raw = localStorage.getItem(CART_KEY);\n    if (raw) setItems(JSON.parse(raw));\n  }, []);\n\n  useEffect(() => {\n    localStorage.setItem(CART_KEY, JSON.stringify(items));\n  }, [items]);\n\n  useEffect(() => {\n    if (!user) return;\n    (async () => {\n      try {\n        const { data } = await orderAPI.getMyOrders();\n        const latest = data[0];\n        if (latest && latest.items.length) setItems(latest.items);\n      } catch {}\n    })();\n  }, [user]);\n\n  const addToCart = useCallback((product, qty = 1) => {\n    setItems((prev) => {\n      const exist = prev.find((x) => x._id === product._id);\n      if (exist) {\n        const updated = { ...exist, qty: Math.min(exist.qty + qty, product.stock) };\n        return prev.map((x) => (x._id === product._id ? updated : x));\n      }\n      return [...prev, { ...product, qty }];\n    });\n  }, []);\n\n  const updateQty = useCallback((id, qty) => {\n    setItems((prev) => prev.map((x) => (x._id === id ? { ...x, qty: Math.min(Math.max(qty, 1), x.stock) } : x)));\n  }, []);\n\n  const removeFromCart = useCallback((id) => {\n    setItems((prev) => prev.filter((x) => x._id !== id));\n  }, []);\n\n  const clearCart = useCallback(() => setItems([]), []);\n\n  const totalPrice = useMemo(() => items.reduce((sum, i) => sum + i.price * i.qty, 0), [items]);\n\n  const value = { cartItems: items, addToCart, updateQty, removeFromCart, clearCart, totalPrice };\n\n  return <CartContext.Provider value={value}>{children}</CartContext.Provider>;\n};\n\nCartProvider.propTypes = { children: PropTypes.node.isRequired };\n"],"mappings":";;AAAA,SAASA,aAAa,EAAEC,QAAQ,EAAEC,SAAS,EAAEC,WAAW,EAAEC,OAAO,QAAQ,OAAO;AAChF,OAAOC,SAAS,MAAM,YAAY;AAClC,SAASC,OAAO,QAAQ,kBAAkB;AAC1C,SAASC,QAAQ,QAAQ,iBAAiB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE3C,OAAO,MAAMC,WAAW,gBAAGV,aAAa,CAAC,CAAC;AAE1C,MAAMW,QAAQ,GAAG,MAAM;AAEvB,OAAO,MAAMC,YAAY,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,EAAA;EAC5C,MAAM;IAAEC;EAAK,CAAC,GAAGT,OAAO,CAAC,CAAC;EAC1B,MAAM,CAACU,KAAK,EAAEC,QAAQ,CAAC,GAAGhB,QAAQ,CAAC,EAAE,CAAC;EAEtCC,SAAS,CAAC,MAAM;IACd,MAAMgB,GAAG,GAAGC,YAAY,CAACC,OAAO,CAACT,QAAQ,CAAC;IAC1C,IAAIO,GAAG,EAAED,QAAQ,CAACI,IAAI,CAACC,KAAK,CAACJ,GAAG,CAAC,CAAC;EACpC,CAAC,EAAE,EAAE,CAAC;EAENhB,SAAS,CAAC,MAAM;IACdiB,YAAY,CAACI,OAAO,CAACZ,QAAQ,EAAEU,IAAI,CAACG,SAAS,CAACR,KAAK,CAAC,CAAC;EACvD,CAAC,EAAE,CAACA,KAAK,CAAC,CAAC;EAEXd,SAAS,CAAC,MAAM;IACd,IAAI,CAACa,IAAI,EAAE;IACX,CAAC,YAAY;MACX,IAAI;QACF,MAAM;UAAEU;QAAK,CAAC,GAAG,MAAMlB,QAAQ,CAACmB,WAAW,CAAC,CAAC;QAC7C,MAAMC,MAAM,GAAGF,IAAI,CAAC,CAAC,CAAC;QACtB,IAAIE,MAAM,IAAIA,MAAM,CAACX,KAAK,CAACY,MAAM,EAAEX,QAAQ,CAACU,MAAM,CAACX,KAAK,CAAC;MAC3D,CAAC,CAAC,MAAM,CAAC;IACX,CAAC,EAAE,CAAC;EACN,CAAC,EAAE,CAACD,IAAI,CAAC,CAAC;EAEV,MAAMc,SAAS,GAAG1B,WAAW,CAAC,CAAC2B,OAAO,EAAEC,GAAG,GAAG,CAAC,KAAK;IAClDd,QAAQ,CAAEe,IAAI,IAAK;MACjB,MAAMC,KAAK,GAAGD,IAAI,CAACE,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,GAAG,KAAKN,OAAO,CAACM,GAAG,CAAC;MACrD,IAAIH,KAAK,EAAE;QACT,MAAMI,OAAO,GAAG;UAAE,GAAGJ,KAAK;UAAEF,GAAG,EAAEO,IAAI,CAACC,GAAG,CAACN,KAAK,CAACF,GAAG,GAAGA,GAAG,EAAED,OAAO,CAACU,KAAK;QAAE,CAAC;QAC3E,OAAOR,IAAI,CAACS,GAAG,CAAEN,CAAC,IAAMA,CAAC,CAACC,GAAG,KAAKN,OAAO,CAACM,GAAG,GAAGC,OAAO,GAAGF,CAAE,CAAC;MAC/D;MACA,OAAO,CAAC,GAAGH,IAAI,EAAE;QAAE,GAAGF,OAAO;QAAEC;MAAI,CAAC,CAAC;IACvC,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMW,SAAS,GAAGvC,WAAW,CAAC,CAACwC,EAAE,EAAEZ,GAAG,KAAK;IACzCd,QAAQ,CAAEe,IAAI,IAAKA,IAAI,CAACS,GAAG,CAAEN,CAAC,IAAMA,CAAC,CAACC,GAAG,KAAKO,EAAE,GAAG;MAAE,GAAGR,CAAC;MAAEJ,GAAG,EAAEO,IAAI,CAACC,GAAG,CAACD,IAAI,CAACM,GAAG,CAACb,GAAG,EAAE,CAAC,CAAC,EAAEI,CAAC,CAACK,KAAK;IAAE,CAAC,GAAGL,CAAE,CAAC,CAAC;EAC9G,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMU,cAAc,GAAG1C,WAAW,CAAEwC,EAAE,IAAK;IACzC1B,QAAQ,CAAEe,IAAI,IAAKA,IAAI,CAACc,MAAM,CAAEX,CAAC,IAAKA,CAAC,CAACC,GAAG,KAAKO,EAAE,CAAC,CAAC;EACtD,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMI,SAAS,GAAG5C,WAAW,CAAC,MAAMc,QAAQ,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;EAErD,MAAM+B,UAAU,GAAG5C,OAAO,CAAC,MAAMY,KAAK,CAACiC,MAAM,CAAC,CAACC,GAAG,EAAEC,CAAC,KAAKD,GAAG,GAAGC,CAAC,CAACC,KAAK,GAAGD,CAAC,CAACpB,GAAG,EAAE,CAAC,CAAC,EAAE,CAACf,KAAK,CAAC,CAAC;EAE7F,MAAMqC,KAAK,GAAG;IAAEC,SAAS,EAAEtC,KAAK;IAAEa,SAAS;IAAEa,SAAS;IAAEG,cAAc;IAAEE,SAAS;IAAEC;EAAW,CAAC;EAE/F,oBAAOvC,OAAA,CAACC,WAAW,CAAC6C,QAAQ;IAACF,KAAK,EAAEA,KAAM;IAAAxC,QAAA,EAAEA;EAAQ;IAAA2C,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAuB,CAAC;AAC9E,CAAC;AAAC7C,EAAA,CAlDWF,YAAY;EAAA,QACNN,OAAO;AAAA;AAAAsD,EAAA,GADbhD,YAAY;AAoDzBA,YAAY,CAACiD,SAAS,GAAG;EAAEhD,QAAQ,EAAER,SAAS,CAACyD,IAAI,CAACC;AAAW,CAAC;AAAC,IAAAH,EAAA;AAAAI,YAAA,CAAAJ,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}